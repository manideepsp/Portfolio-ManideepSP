---
import BaseLayout from '../layouts/BaseLayout.astro';
import config from '../lib/config.json';
import ProjectCard from '../components/ProjectCard.astro';
import ExperienceTimeline from '../components/ExperienceTimeline.astro';
import ScrollRevealWrapper from '../components/ScrollRevealWrapper.astro';
import { renderMarkdown } from '../lib/markdown.js';
import fs from 'fs';

// Compute base path for assets
const basePath = Astro.site ? new URL(Astro.site).pathname.replace(/\/$/, '') : '';

let aboutHtml = '';
try {
  // Read markdown file path from config
  const mdPath = config.about?.markdownFile || '/content/about.md';
  const md = fs.readFileSync(new URL(`../..${mdPath}`, import.meta.url), 'utf8');
  aboutHtml = await renderMarkdown(md);
} catch (e) {
  aboutHtml = '<p>No about content yet.</p>';
}

// Use projects from config
const projects = config.projects || [];
---
<BaseLayout title="Home">
  <section class="hero single-page">
    <p class="uppercase tracking-widest text-sm font-semibold" style="color: var(--accent);">{config.hero.role}</p>
    <h1 class="text-5xl font-bold leading-tight">{config.hero.name}</h1>
    <p class="text-lg" style="color: var(--muted);">{config.hero.title}</p>
    <p class="text-lg" style="color: var(--muted); font-weight: 400;">{config.hero.tagline}</p>
    <div class="ctas">
      <a class="btn primary" href={`https://github.com/${config.social.github}`} target="_blank">GitHub</a>
      <a class="btn ghost" href={`${basePath}${config.resume.displayLink}`} target="_blank">Download Resume</a>
    </div>
  </section>

  <section class="single-page about-block">
    <h2>About</h2>
    <div class="markdown-render" set:html={aboutHtml}></div>
  </section>

  <section class="single-page split-layout">
    <div class="projects-column">
      <h2>Projects</h2>
      <div class="projects-list">
        {projects.map((p, i) => (
          <ScrollRevealWrapper delay={i * 80}>
            <ProjectCard 
              title={p.title} 
              description={p.description} 
              image={p.image} 
              repoUrl={p.repoUrl} 
            />
          </ScrollRevealWrapper>
        ))}
      </div>
    </div>
    <div class="timeline-column timeline-right">
      <h2>Experience</h2>
      <ExperienceTimeline />
    </div>
  </section>
</BaseLayout>
