---
import BaseLayout from '../layouts/BaseLayout.astro';
import config from '../lib/config.json';
import ProjectCard from '../components/ProjectCard.astro';
import ExperienceTimeline from '../components/ExperienceTimeline.astro';
import ScrollRevealWrapper from '../components/ScrollRevealWrapper.astro';
import { slugify } from '../lib/slugify.js';

// Compute base path for assets
const basePath = Astro.site ? new URL(Astro.site).pathname.replace(/\/$/, '') : '';

// Use projects from config
const projects = (config.projects || []).map((p) => ({ ...p, slug: p.slug || slugify(p.title) }));
// Split full name into parts for responsive line-break control
// Prefer explicit first/last if provided in config
const firstName = (config.hero && config.hero.firstName) ? config.hero.firstName : ((config.hero && config.hero.name) ? config.hero.name.split(' ')[0] : '');
const lastName = (config.hero && config.hero.lastName) ? config.hero.lastName : ((config.hero && config.hero.name) ? config.hero.name.split(' ').slice(1).join(' ') : '');
---
<BaseLayout title="Home">
  <section class="hero single-page hero-modern">
    <div class="hero-content">
      <div class="hero-main">
        <div class="hero-text">
          <span class="eyebrow">{config.hero.role}</span>
          <h1 class="headline">
            <span class="headline-first">{firstName}</span>
            <span class="headline-last">{lastName}</span>
          </h1>
        </div>
      </div>
      <div class="hero-asset">
        <picture>
          <source type="image/webp" srcset={`${basePath}/images/Hero-animation/josh-happy-dark.webp`} />
          <img src={`${basePath}/images/Hero-animation/josh-happy-dark.webp`} alt="Animated Hero" class="hero-svg-anim" loading="eager" decoding="async" />
        </picture>
      </div>

      <!-- Details (subtitles + CTAs) are part of the hero grid and live in row 2 -->
      <div class="hero-details">
        <div class="sub hero-body">{config.hero.title}</div>
        <div class="sub hero-tagline">{config.hero.tagline}</div>
        <div class="ctas">
          <a class="btn primary" href={`https://github.com/${config.social.github}`} target="_blank">GitHub</a>
          <a class="btn ghost" href={`${basePath}${config.resume.displayLink}`} target="_blank">Download Resume</a>
        </div>
      </div>
    </div>

    <div class="hero-bg-gradient" aria-hidden="true"></div>
  </section>

  <section class="single-page split-layout">
    <div class="projects-column">
      <h2>Projects</h2>
      <div class="projects-list">
        {projects.map((p, i) => (
          <ScrollRevealWrapper delay={i * 80}>
            <ProjectCard 
              title={p.title} 
              description={p.description} 
              image={p.image} 
              repoUrl={p.repoUrl}
              demoUrl={p.demoUrl}
              slug={p.slug}
              tags={p.tags}
            />
          </ScrollRevealWrapper>
        ))}
      </div>
    </div>
    <div class="timeline-column timeline-right">
      <h2>Experience</h2>
      <ExperienceTimeline />
    </div>
  </section>
</BaseLayout>
