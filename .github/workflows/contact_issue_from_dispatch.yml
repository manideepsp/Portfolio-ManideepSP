name: Create Contact Issue from repository_dispatch
on:
  repository_dispatch:
    types: [contact_form]

jobs:
  create_issue:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
      - name: Create issue from payload (github-script)
        uses: actions/github-script@v6
        with:
          script: |
            const payload = github.context.payload.client_payload || {};
            const owner = payload.owner || github.context.repo.owner;
            const repo = payload.repo || github.context.repo.repo;
            const title = payload.title || 'Portfolio Contact';
            const body = `**From:** ${payload.name || 'Unknown'}  \n**Email:** ${payload.email || 'n/a'}  \n**Position:** ${payload.position || ''}\n\n${payload.message || ''}`;
            const assignees = payload.assignee ? String(payload.assignee).split(',').map(s => s.trim()).filter(Boolean) : [];
            await github.rest.issues.create({ owner, repo, title, body, assignees });